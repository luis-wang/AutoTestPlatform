{% extends "navs.html" %}
{% load staticfiles %}
{% load customTags %}
{% block title %}
    创建任务
{% endblock %}
{% block css %}
    <style type="text/css">
        .textarea {
            resize: none;
            overflow-y: hidden;
        }

        .panel.noborder {
            border: none;
            box-shadow: none;
        }

        .panel.noborder > .panel-heading {
            border: 1px solid #dddddd;
            border-radius: 0;
        }

        table.borderless td, table.borderless th {
            border: none !important;
        }
    </style>
{% endblock %}
{% block mainbody %}
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">执行任务</h1>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <div class="alert alert-info alert-dismissable">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        请执行相关的测试任务！
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-body" style="padding-left: 20px">
                    <div class="row">
                        <label> 项目管理相关权限测试！ </label>
                        <button class="btn btn-default" id="btnTestProject">执行</button>
                    </div>
                    <div class="row">
                        <label>文档管理相关权限测试！</label>
                        <button class="btn btn-default" id="btnTestDocuments">执行</button>
                    </div>
                    <div class="row">
                        <label>组织相关权限测试！</label>
                        <button class="btn btn-default" id="btnTestGroup">执行</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.col-lg-4 -->

{% endblock %}

{% block scriptLinks %}
    <script src="{% static 'js/jsrender.min.js' %}"></script>
    <script src="{% static 'js/sweetalert.min.js' %}"></script>
{% endblock %}
{% block script %}
    <script type="text/javascript">
        {#    请求产品的套件列表#}

        function run_test(test_type) {
            $.ajax(
                {
                    url: '{% url "task:runSomeTest" %}',
                    data: {'type': test_type, csrfmiddlewaretoken: '{{ csrf_token }}'},
                    type: "post",

                    dataType: "json",
                    beforeSend: function () {
                        swal("正在执行中，执行可能需要几分钟，请稍后查看！");
                        $("#btnTestProject").html("执行中").attr("disabled", "disabled");
                        $("#btnTestDocuments").html("执行中").attr("disabled", "disabled");
                        $("#btnTestGroup").html("执行中").attr("disabled", "disabled");
                    },
                    success: function (data) {
                        $("#btnTestProject").html("执行").removeAttr("disabled");
                        $("#btnTestDocuments").html("执行").removeAttr("disabled");
                        $("#btnTestGroup").html("执行").removeAttr("disabled");
                        let report_file = data["file_name"];
                        window.location.href = "/task/showReport/" + report_file;
                    }
                }
            )
        }


        $(document).ready(function () {
            $.views.settings.delimiters("<%", "%>");
            $("#btnTestProject").click(function () {
                run_test(1)
            });
            $("#btnTestDocuments").click(function () {
                run_test(2)
            });
            $("#btnTestGroup").click(function () {
                run_test(3)
            });
        })

    </script>
{% endblock %}

